<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>WatchGarden</title>
  <script type="module">
    // Importation Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
    import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "TON_API_KEY",
      authDomain: "TON_DOMAINE.firebaseapp.com",
      databaseURL: "https://TON_DOMAINE.firebaseio.com",
      projectId: "TON_PROJECT_ID",
      storageBucket: "TON_PROJECT_ID.appspot.com",
      messagingSenderId: "TON_SENDER_ID",
      appId: "TON_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    const loginBtn = document.getElementById("loginBtn");
    const voirBtn = document.getElementById("voirBtn");

    loginBtn.addEventListener("click", () => {
      const provider = new GoogleAuthProvider();
      signInWithPopup(auth, provider)
        .then((result) => {
          const user = result.user;

          // Enregistrement de l'utilisateur dans la base
          set(ref(db, "users/" + user.uid), {
            name: user.displayName,
            email: user.email
          });

          alert("Connecté : " + user.displayName);

          // Demande le pseudo à voir
          const targetName = prompt("Quel est le pseudo de l’utilisateur que tu veux voir ?");
          if (targetName) {
            voirInfos(targetName);
          }

          // Affiche le bouton "voir infos"
          voirBtn.style.display = "inline-block";
        })
        .catch((error) => {
          alert("Erreur de connexion : " + error.message);
        });
    });

    // Fonction pour voir les infos d’un utilisateur
    function voirInfos(pseudo) {
      const dbRef = ref(db, "users/");
      get(dbRef).then((snapshot) => {
        if (snapshot.exists()) {
          let found = false;
          snapshot.forEach((child) => {
            const data = child.val();
            if (data.name === pseudo) {
              alert(`Infos de ${pseudo} :\nNom : ${data.name}\nEmail : ${data.email}`);
              found = true;
            }
          });
          if (!found) alert("Utilisateur non trouvé !");
        } else {
          alert("Aucun utilisateur dans la base.");
        }
      });
    }

    // Quand on clique sur "voir infos"
    voirBtn.addEventListener("click", () => {
      const targetName = prompt("Entrer le pseudo d’un utilisateur connecté :");
      if (targetName) voirInfos(targetName);
    });
  </script>
</head>
<body style="text-align: center; font-family: sans-serif; background-color: #111; color: white;">

  <h1>WatchGarden</h1>
  <p>Regardez des vidéos ensemble, de n’importe où.</p>

  <button id="loginBtn">Se connecter avec Google</button>
  <button id="voirBtn" style="display: none; margin-left: 10px;">Voir les infos d’un autre</button>

</body>
</html>
